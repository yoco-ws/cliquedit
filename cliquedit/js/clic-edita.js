var ClicEdita=function(API_key,domain,localHandler){var private={API_key:API_key,domain:domain,LOCAL_MEDIA_HANDLER:localHandler};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},init:function(){null!=private.API_key?(console.log("Inicializando eventos de edición"),insertImageHelpers(),startNotifications(),startEventListeners(),insertContextMenu()):console.log("Debes definir la API Key en el archivo php")},notify:function(message,type){var options={body:message,icon:"success"==type?"https://yoco.ws/clic-edita/img/n_success.png":"https://yoco.ws/clic-edita/img/n_error.png"};if("Notification"in window)if("granted"===Notification.permission)new Notification("Clic Edita",options);else alert("Clic Edita\n"+options.body);else alert("Clic Edita\n"+options.body)}}};function insertImageHelpers(){$("body").append('\x3c!-- Formularios auxiliares para la subida de archivos --\x3e<form style="display:none" id="ce-image-container"><input type="file" name="ce-image" id="ce-image"></form><form style="display:none" id="ce-image-sharing-container"><input type="file" name="ce-image" id="ce-sharing-image"></form><form style="display:none" id="ce-image-page-container"><input type="file" name="ce-image" id="ce-page-image"></form><form style="display:none" id="ce-image-video-container"><input type="file" name="ce-image" id="ce-video-image"></form><form style="display:none" data-ce-selected-subdir="audio" id="ce-audio-container"><input type="file" name="ce-audio" id="ce-audio"></form><form style="display:none" data-ce-selected-subdir="video" id="ce-video-container"><input type="file" name="ce-video" id="ce-video"></form>')}function startNotifications(){"Notification"in window?(Notification.permission,"denied"!==Notification.permission&&"granted"!==Notification.permission&&Notification.requestPermission(function(permission){})):console.log("El navegador no soporta notificaciones")}function startEventListeners(){$(document).ready(function(){$("*[data-ce-text]").attr("contenteditable",!0),$("*[data-ce-article] a[data-ce-read-full]").click(function(event){event.preventDefault()}),$("*[data-ce-embed] iframe").bind("contextmenu taphold",function(e){e.preventDefault()}),$(document).on("paste","*[contenteditable]",function(e){e.preventDefault();var text=e.originalEvent.clipboardData.getData("text/plain");text=text.replace(/<div>(.*)<\/div>/g,"$1<br />"),document.execCommand("inserttext",!1,text);var formattedText=$(this).html();console.log(formattedText),formattedText=(formattedText=formattedText.replace(/<div>/g,"")).replace(/<\/div>/g,"<br/>"),$(this).html(formattedText)}),$("*[data-ce-text]").on("click touchstart",function(event){var requiresAdvanced=!1,attr=$(this).attr("data-ce-richtext");void 0!==attr&&!1!==attr&&(requiresAdvanced=!0),$(document).trigger("TEXT_CHANGE_REQUEST",[$(this),requiresAdvanced])}),$("*[data-ce-anchor]").click(function(event){event.preventDefault(),event.shiftKey&&$(document).trigger("ANCHOR_CHANGE_REQUEST",$(this))}),$("form#ce-image-container > input[type=file]").change(function(event){$(document).trigger("IMAGE_CHANGE_REQUEST",$("form#ce-image-container"))}),$("form#ce-image-video-container > input[type=file]").change(function(event){$(document).trigger("VIDEO_POSTER_CHANGE_REQUEST",$("form#ce-image-video-container"))}),$("form#ce-image-sharing-container > input[type=file]").change(function(event){$(document).trigger("ARTICLE_SHARINGIMAGE_CHANGE_REQUEST",$("form#ce-image-sharing-container"))}),$("form#ce-image-page-container > input[type=file]").change(function(event){$(document).trigger("PAGE_SHARINGIMAGE_CHANGE_REQUEST",$("form#ce-image-page-container"))}),$("form#ce-audio-container > input[type=file]").change(function(event){$(document).trigger("AUDIO_UPLOAD_CHANGE_REQUEST",$("form#ce-audio-container"))}),$("form#ce-video-container > input[type=file]").change(function(event){$(document).trigger("VIDEO_UPLOAD_CHANGE_REQUEST",$("form#ce-video-container"))}),$("img[data-ce-image]").click(function(event){event.preventDefault();var id=$(this).attr("data-ce-image"),subdir=$(this).attr("data-subdirectory"),article=$(this).closest("[data-ce-article]").attr("data-ce-article"),category=$(this).closest("[data-ce-category]").attr("data-ce-category");void 0!==article&&!1!==article&&void 0!==category&&!1!==category||($("form#ce-image-container").removeAttr("data-ce-selected-article"),$("form#ce-image-container").removeAttr("data-ce-selected-category")),$("form#ce-image-container").attr("data-ce-selected-image",id),$("form#ce-image-container").attr("data-ce-selected-subdir",subdir),$("form#ce-image-container").attr("data-ce-selected-article",article),$("form#ce-image-container").attr("data-ce-selected-category",category),$("form#ce-image-container > input[type=file]").click()}),$("label[data-ce-image]").click(function(event){event.preventDefault();var id=$(this).attr("data-ce-image"),subdir=$(this).attr("data-subdirectory"),article=$(this).closest("[data-ce-article]").attr("data-ce-article"),category=$(this).closest("[data-ce-category]").attr("data-ce-category");void 0!==article&&!1!==article&&void 0!==category&&!1!==category||($("form#ce-image-container").removeAttr("data-ce-selected-article"),$("form#ce-image-container").removeAttr("data-ce-selected-category")),$("form#ce-image-container").attr("data-ce-selected-image",id),$("form#ce-image-container").attr("data-ce-selected-subdir",subdir),$("form#ce-image-container").attr("data-ce-selected-article",article),$("form#ce-image-container").attr("data-ce-selected-category",category),$("form#ce-image-container > input[type=file]").click()})})}function insertContextMenu(){$("body").append('<div id="ce-context-menu" class="dropdown clearfix"><div class="enc-ce"><p>cliqued.it</p></div><ul role="menu" aria-labelledby="dropdownMenu" style="display:block;position:static;margin-bottom:5px;"></ul></div>');var $contextMenu=$("div#ce-context-menu"),$contextMenuList=$("div#ce-context-menu ul");$("[data-ce-siblings], [data-ce-embed], [data-ce-page], [data-ce-none], [data-ce-audio], [data-ce-image], [data-ce-anchor], [data-ce-video], [data-ce-article], [data-ce-text]").on("contextmenu taphold",function(e){var elementType;$("div#ce-context-menu ul li").remove("click"),$contextMenu.addClass("active"),$contextMenuList.html(""),e.stopPropagation(),$(this).each(function(){$.each(this.attributes,function(){this.specified&&(-1!==this.name.indexOf("data-ce-")&&(elementType=this.name))})}),insertMenuOptions($contextMenuList,$(this),elementType),$(this).siblings("[data-ce-siblings], [data-ce-siblings][data-ce-embed], [data-ce-siblings][data-ce-page], [data-ce-siblings][data-ce-none], [data-ce-siblings][data-ce-audio], [data-ce-siblings][data-ce-image], [data-ce-siblings][data-ce-text], [data-ce-siblings][data-ce-anchor], [data-ce-siblings][data-ce-video]").each(function(){$.each(this.attributes,function(){this.specified&&(-1!==this.name.indexOf("data-ce-")&&(elementType=this.name))}),insertMenuOptions($contextMenuList,$(this),elementType)});for(var $editableParent=$(this).parent().closest("[data-ce-siblings], [data-ce-embed], [data-ce-page], [data-ce-none], [data-ce-audio], [data-ce-image], [data-ce-article], [data-ce-anchor], [data-ce-text], [data-ce-video]");0<$editableParent.length;){$editableParent.each(function(){$.each(this.attributes,function(){this.specified&&(-1!==this.name.indexOf("data-ce-")&&(elementType=this.name))})}),insertMenuOptions($contextMenuList,$editableParent,elementType),$editableParent.siblings("[data-ce-siblings], [data-ce-siblings][data-ce-embed], [data-ce-siblings][data-ce-page], [data-ce-siblings][data-ce-none], [data-ce-siblings][data-ce-audio], [data-ce-siblings][data-ce-image], [data-ce-siblings][data-ce-text], [data-ce-siblings][data-ce-anchor], [data-ce-siblings][data-ce-video]").each(function(){$.each(this.attributes,function(){this.specified&&(-1!==this.name.indexOf("data-ce-")&&(elementType=this.name))}),insertMenuOptions($contextMenuList,$(this),elementType)}),$editableParent=$editableParent.parent().closest("[data-ce-siblings], [data-ce-embed], [data-ce-page], [data-ce-none], [data-ce-audio], [data-ce-image], [data-ce-article], [data-ce-anchor], [data-ce-video], [data-ce-text]")}var left,menuWidth=$contextMenu.width(),pageWidth=$(window).width();return left=e.pageX>pageWidth-menuWidth?pageWidth-menuWidth:e.pageX,$contextMenu.css({display:"block",left:left,top:e.pageY}),$("html").keydown(function(e){27==e.keyCode&&($contextMenu.hide(),$contextMenu.removeClass("active"),$("div#ce-context-menu ul li").remove("click"),$contextMenuList.html(""),$("html").unbind("keydown"))}),!1}),$("html").click(function(){$contextMenu.removeClass("active"),$contextMenu.hide(),$("div#ce-context-menu ul li").remove("click"),$contextMenuList.html("")})}function insertMenuOptions(menuList,subject,elementType){switch(elementType){case"data-ce-page":var $submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/Pagina.svg"></div><li><p><strong>Pagina</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>'),$sharing_menu=$("<li><p><strong>SEO</strong></p></li>"),$sharing_opt=$('<li><ul class="ce-options"></ul></li>'),$describeSharingKeyword=$('<li class="ce-option" class="ce-option"><p>Palabras Clave...</p></li>').click(function(){$(document).trigger("PAGE_SHARINGKEYWORD_CHANGE_REQUEST",subject)}),$describeSharingTitle=$('<li class="ce-option" class="ce-option"><p>Título...</p></li>').click(function(){$(document).trigger("PAGE_SHARINGTITLE_CHANGE_REQUEST",subject)}),$describeSharingDesc=$('<li class="ce-option"><p>Descripción...</p></li>').click(function(){$(document).trigger("PAGE_SHARINGDESC_CHANGE_REQUEST",subject)}),$describeSharingImage=$('<li class="ce-option" style="height:30px"><label data-ce-page-image data-ce-page-id="'+subject.attr("data-ce-page")+'" data-subdirectory="sharing_images" for="ce-image"><p>Imagen...</p></label><li>').click(function(){event.preventDefault();var $ce_label=$(this).children("label[data-ce-page-image]"),pageId=$ce_label.attr("data-ce-page-id"),subdir=$ce_label.attr("data-subdirectory");$("form#ce-image-page-container").attr("data-ce-selected-subdir",subdir),$("form#ce-image-page-container").attr("data-ce-selected-page",pageId),$("form#ce-image-page-container > input[type=file]").click()});$sharing_opt.children(".ce-options").append($describeSharingKeyword).append($describeSharingTitle).append($describeSharingDesc).append($describeSharingImage),$sharing_menu.append($sharing_opt),$option.children(".ce-options").append($sharing_menu),$submenu.append($option),menuList.append($submenu);break;case"data-ce-text":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/texto.svg"></div><li><p><strong>Texto</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');var $composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu);break;case"data-ce-anchor":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/icono-enlace.svg"></div><li><p><strong>Enlace</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');var $edit_anchor=$('<li class="ce-option"><p>Editar...</p></li>').click(function(){$(document).trigger("ANCHOR_CHANGE_REQUEST",subject)}),$open_anchor=$('<a href="'+subject.attr("href")+'"><li class="ce-option"><p>Abrir...</p></li></a>');$option.children(".ce-options").append($edit_anchor).append($open_anchor);$composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu);break;case"data-ce-audio":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/icono-audio.svg"></div><li><p><strong>Audio</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');var $edit_audio_url=$('<li class="ce-option"><p>Cambiar mediante URL...</p></li>').click(function(){$(document).trigger("AUDIO_URL_CHANGE_REQUEST",subject)}),$upload_audio=$('<li class="ce-option"><p>Subir audio...</p></li>').click(function(event){event.preventDefault();var id=subject.attr("data-ce-audio"),article=subject.closest("[data-ce-article]").attr("data-ce-article"),category=subject.closest("[data-ce-category]").attr("data-ce-category");void 0!==article&&!1!==article&&void 0!==category&&!1!==category||($("form#ce-audio-container").removeAttr("data-ce-selected-article"),$("form#ce-audio-container").removeAttr("data-ce-selected-category")),$("form#ce-audio-container").attr("data-ce-selected-audio",id),$("form#ce-audio-container").attr("data-ce-selected-article",article),$("form#ce-audio-container").attr("data-ce-selected-category",category),$("form#ce-audio-container > input[type=file]").click()});$option.children(".ce-options").append($edit_audio_url).append($upload_audio);$composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu);break;case"data-ce-video":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/video.svg"></div><li><p><strong>Video</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');var $edit_video_url=$('<li class="ce-option"><p>Cambiar mediante URL...</p></li>').click(function(){$(document).trigger("VIDEO_URL_CHANGE_REQUEST",subject)}),$upload_video=$('<li class="ce-option"><p>Subir video...</p></li>').click(function(event){event.preventDefault();var id=subject.attr("data-ce-video"),article=subject.closest("[data-ce-article]").attr("data-ce-article"),category=subject.closest("[data-ce-category]").attr("data-ce-category");void 0!==article&&!1!==article&&void 0!==category&&!1!==category||($("form#ce-video-container").removeAttr("data-ce-selected-article"),$("form#ce-video-container").removeAttr("data-ce-selected-category")),$("form#ce-video-container").attr("data-ce-selected-video",id),$("form#ce-video-container").attr("data-ce-selected-article",article),$("form#ce-video-container").attr("data-ce-selected-category",category),$("form#ce-video-container > input[type=file]").click()}),$editPoster=$('<li class="ce-option" style="height:30px"><label data-ce-video-image data-ce-video-article="'+subject.closest("[data-ce-article]").attr("data-ce-article")+'" data-ce-video-category="'+subject.closest("[data-ce-category]").attr("data-ce-category")+'" data-subdirectory="video_images" for="ce-image"><p>Cambiar vista previa...</p></label><li>').click(function(){event.preventDefault();var $ce_label=$(this).children("label[data-ce-video-image]"),subdir=$ce_label.attr("data-subdirectory"),article=$ce_label.attr("data-ce-video-article"),category=$ce_label.attr("data-ce-video-category"),id=subject.attr("data-ce-video");void 0!==article&&!1!==article&&void 0!==category&&!1!==category||($("form#ce-image-video-container").attr("data-ce-selected-article",article),$("form#ce-image-video-container").attr("data-ce-selected-category",category)),$("form#ce-image-video-container").attr("data-ce-selected-subdir",subdir),$("form#ce-image-video-container").attr("data-ce-selected-video",id),$("form#ce-image-video-container > input[type=file]").click()});$option.children(".ce-options").append($edit_video_url).append($upload_video).append($editPoster);$composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu);break;case"data-ce-image":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/imagen.svg"></div><li><p><strong>Imagen</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');var $edit_src=$('<li class="ce-option"><p>Cambiar...</p></li>').click(function(){$(subject).trigger("click")}),$edit_alt=$('<li class="ce-option"><p>Describir...</p></li>').click(function(){$(document).trigger("IMAGE_ALT_CHANGE_REQUEST",subject)});addComposedOptions($(subject),$option.children("ce-options")),$option.children(".ce-options").append($edit_src).append($edit_alt);$composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu);break;case"data-ce-article":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/articulo.svg"></div><li><p><strong>Artículo</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');0<subject.find("a[data-ce-read-full]").length&&($read=$('<li class="ce-option"><a href='+subject.find("a[data-ce-read-full]").attr("href")+"><p>Editar...</p></a></li>"),$option.children(".ce-options").append($read));var $publish=$('<li class="inactive ce-option"><p>Publicar...</p></li>').click(function(){$(document).trigger("ARTICLE_PUBLISH_REQUEST",subject)});if($option.children(".ce-options").append($publish),subject.closest("[data-ce-category][data-ce-single-article]").length){$sharing_menu=$("<li><p><strong>Compartir</strong></p></li>"),$sharing_opt=$('<li><ul class="ce-options"></ul></li>');var $describeFriendlyUrl=$('<li class="ce-option" class="ce-option"><p>URL corta...</p></li>').click(function(){$(document).trigger("ARTICLE_FRIENDLYURL_CHANGE_REQUEST",subject)}),$describeKeywords=$('<li class="ce-option"><p>Etiquetas...</p></li>').click(function(){$(document).trigger("ARTICLE_KEYWORD_CHANGE_REQUEST",subject)});$describeSharingTitle=$('<li class="ce-option" class="ce-option"><p>Título...</p></li>').click(function(){$(document).trigger("ARTICLE_SHARINGTITLE_CHANGE_REQUEST",subject)}),$describeSharingDesc=$('<li class="ce-option"><p>Descripción...</p></li>').click(function(){$(document).trigger("ARTICLE_SHARINGDESC_CHANGE_REQUEST",subject)}),$describeSharingImage=$('<li class="ce-option" style="height:30px"><label data-ce-sharing-image data-ce-sharing-article="'+subject.attr("data-ce-article")+'" data-ce-sharing-category="'+subject.closest("[data-ce-category]").attr("data-ce-category")+'" data-subdirectory="sharing_images" for="ce-image"><p>Imagen...</p></label><li>').click(function(){event.preventDefault();var $ce_label=$(this).children("label[data-ce-sharing-image]"),subdir=$ce_label.attr("data-subdirectory"),article=$ce_label.attr("data-ce-sharing-article"),category=$ce_label.attr("data-ce-sharing-category");$("form#ce-image-sharing-container").attr("data-ce-selected-subdir",subdir),$("form#ce-image-sharing-container").attr("data-ce-selected-article",article),$("form#ce-image-sharing-container").attr("data-ce-selected-category",category),$("form#ce-image-sharing-container > input[type=file]").click()});$sharing_opt.children(".ce-options").append($describeFriendlyUrl).append($describeKeywords).append($describeSharingTitle).append($describeSharingDesc).append($describeSharingImage),$sharing_menu.append($sharing_opt),$option.children(".ce-options").append($sharing_menu)}var $move_up=$('<li class="inactive ce-option"><p>Subir...</p></li>'),$move_down=$('<li class="inactive ce-option"><p>Bajar...</p></li>'),$delete=$('<li class="ce-option"><p>Eliminar...</p></li>').click(function(){$(document).trigger("ARTICLE_REMOVAL_REQUEST",subject)});$option.children(".ce-options").append($move_up).append($move_down).append($delete),$submenu.append($option),menuList.append($submenu);break;case"data-ce-embed":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/embebido.svg"></div><li><p><strong>Código Embebido</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>');var $edit_embed=$('<li class="ce-option"><p>Cambiar código...</p></li>').click(function(){$(document).trigger("EMBED_CHANGE_REQUEST",subject)});$option.children(".ce-options").append($edit_embed);$composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu);break;case"data-ce-none":$submenu=$('<ul class="submenu"><div><img class="icono-ce" src="http://cliqued.it/ce-resources/img/icono-enlace.svg"></div><li><p><strong>Elemento oculto</strong></p></li></ul>'),$option=$('<li><ul class="ce-options"></ul></li>'),$composedOptions=addComposedOptions($(subject),$option.children("ce-options"));$option.children(".ce-options").append($composedOptions),$submenu.append($option),menuList.append($submenu)}}function addComposedOptions(node,optionList){var $composedWrapper=node.parent("[data-ce-composed]");if(0<$composedWrapper.length){var optionsArray=$composedWrapper.attr("data-ce-composedval").split(","),$options=$("<span></span>");for(i=0;i<optionsArray.length;i++)switch(optionsArray[i]){case"img":var $changeToImg=$('<li class="ce-option"><p>Cambiar por imagen...</p></li>').click(function(){$(document).trigger("COMPOSED_TYPE_CHANGE_REQUEST",[$composedWrapper,"img"])});$options.append($changeToImg);break;case"txt":var $changeToTxt=$('<li class="ce-option"><p>Cambiar por texto...</p></li>').click(function(){$(document).trigger("COMPOSED_TYPE_CHANGE_REQUEST",[$composedWrapper,"txt"])});$options.append($changeToTxt);break;case"video":var $changeToVideo=$('<li class="ce-option"><p>Cambiar por video...</p></li>').click(function(){$(document).trigger("COMPOSED_TYPE_CHANGE_REQUEST",[$composedWrapper,"video"])});$options.append($changeToVideo);break;case"audio":var $changeToAudio=$('<li class="ce-option"><p>Cambiar por audio...</p></li>').click(function(){$(document).trigger("COMPOSED_TYPE_CHANGE_REQUEST",[$composedWrapper,"audio"])});$options.append($changeToAudio);break;case"embed":var $changeToEmbed=$('<li class="ce-option"><p>Cambiar por código embebido...</p></li>').click(function(){$(document).trigger("COMPOSED_TYPE_CHANGE_REQUEST",[$composedWrapper,"embed"])});$options.append($changeToEmbed);break;case"none":var $changeToNone=$('<li class="ce-option"><p>Ocultar...</p></li>').click(function(){$(document).trigger("COMPOSED_TYPE_CHANGE_REQUEST",[$composedWrapper,"none"])});$options.append($changeToNone)}return $options}}function triggerAnchorEdition(subject){$(document).trigger("ANCHOR_CHANGE_REQUEST",$(subject))}$(document).one("TEXT_CHANGE_REQUEST",function textChangeRequest(event,subject,isAdvancedEditor){var subjectId=$(subject).attr("data-ce-text"),pageId=$("html").attr("data-ce-page"),content=$(subject).html(),textComponent=new TextComponent(subjectId,pageId,content);isAdvancedEditor?textComponent.getAdvancedEditor(subject).then(function(response){$(document).one("TEXT_CHANGE_REQUEST",textChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=textComponent.getValues(),senderComponent=new SenderComponent("aggregation","text",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId)}var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),$(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"failure")})},function(error){$(document).one("TEXT_CHANGE_REQUEST",textChangeRequest),console.log("Failure",error),"Sin cambios"!==error&&clicEdita.notify(error,"failure")}):textComponent.getSimpleEditor(subject).then(function(response){$(document).one("TEXT_CHANGE_REQUEST",textChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=textComponent.getValues(),senderComponent=new SenderComponent("aggregation","text",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId)}var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),$(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"failure")})},function(error){$(document).one("TEXT_CHANGE_REQUEST",textChangeRequest),console.log("Failure",error),"Sin cambios"!==error&&clicEdita.notify(error,"failure")})}),$(document).one("AUDIO_URL_CHANGE_REQUEST",function audioChangeRequest(event,subject){var subjectId=$(subject).attr("data-ce-audio"),pageId=$("html").attr("data-ce-page"),src=$(subject).attr("src"),audioComponent=new AudioComponent(subjectId,pageId,src);audioComponent.getSimpleEditor(subject).then(function(response){$(document).one("AUDIO_URL_CHANGE_REQUEST",audioChangeRequest),console.log("Elemento editado exitosamente:\n",response);var esArticulo,elemValues=audioComponent.getValues(),senderComponent=new SenderComponent("aggregation","audio",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId),esArticulo=!0}else esArticulo=!1;var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),esArticulo&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),esArticulo?$("[data-ce-article="+articleId+'] [data-ce-audio="'+subjectId+'"]').attr("src",elemValues.src):$("[data-ce-audio="+subjectId+"]").attr("src",elemValues.src),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("AUDIO_URL_CHANGE_REQUEST",audioChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("VIDEO_URL_CHANGE_REQUEST",function videoChangeRequest(event,subject){var subjectId=$(subject).attr("data-ce-video"),pageId=$("html").attr("data-ce-page"),src=$(subject).attr("src"),videoComponent=new VideoComponent(subjectId,pageId,src);videoComponent.getSimpleEditor(subject).then(function(response){$(document).one("VIDEO_URL_CHANGE_REQUEST",videoChangeRequest),console.log("Elemento editado exitosamente:\n",response);var esArticulo,elemValues=videoComponent.getValues(),senderComponent=new SenderComponent("aggregation","video",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId),esArticulo=!0}else esArticulo=!1;var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),esArticulo&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),esArticulo?$("[data-ce-article="+articleId+'] [data-ce-video="'+subjectId+'"]').attr("src",elemValues.src):$("[data-ce-video="+subjectId+"]").attr("src",elemValues.src),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("VIDEO_URL_CHANGE_REQUEST",videoChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("AUDIO_UPLOAD_CHANGE_REQUEST",function audioUploadChangeRequest(event,subject,contentType){console.log("seleccionado audio exitosamente");var subdir=$(subject).attr("data-ce-selected-subdir");(new LocalStorageComponent).requestAudioAggregation(subject,subdir).then(function(response){console.log(response.msg);var subjectId=$(subject).attr("data-ce-selected-audio"),pageId=$("html").attr("data-ce-page"),src=response.path,elemValues=new AudioComponent(subjectId,pageId,src).getValues(),senderComponent=new SenderComponent("aggregation","audio",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),esArticulo=!1,articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category");void 0!==articleId&&!1!==articleId&&(articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category"),senderComponent.set("category",categoryId),senderComponent.set("article",articleId),esArticulo=!0);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){clicEdita.notify(response,"success"),console.log(response),esArticulo&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),esArticulo?$("[data-ce-article="+articleId+'] [data-ce-audio="'+subjectId+'"]').attr("src",src):$("[data-ce-audio="+subjectId+"]").attr("src",src),$(document).one("AUDIO_UPLOAD_CHANGE_REQUEST",audioUploadChangeRequest)},function(error){console.log(error),clicEdita.notify(error,"failure"),$(document).one("AUDIO_UPLOAD_CHANGE_REQUEST",audioUploadChangeRequest)})},function(error){console.log(error),clicEdita.notify(error,"error"),$(document).one("AUDIO_UPLOAD_CHANGE_REQUEST",audioUploadChangeRequest)})}),$(document).one("VIDEO_UPLOAD_CHANGE_REQUEST",function videoUploadChangeRequest(event,subject,contentType){console.log("seleccionado video exitosamente");var subdir=$(subject).attr("data-ce-selected-subdir");(new LocalStorageComponent).requestVideoAggregation(subject,subdir).then(function(response){console.log(response.msg);var subjectId=$(subject).attr("data-ce-selected-video"),pageId=$("html").attr("data-ce-page"),src=response.path,elemValues=new VideoComponent(subjectId,pageId,src).getValues(),senderComponent=new SenderComponent("aggregation","video",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),esArticulo=!1,articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category");void 0!==articleId&&!1!==articleId&&(articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category"),senderComponent.set("category",categoryId),senderComponent.set("article",articleId),esArticulo=!0);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){clicEdita.notify(response,"success"),console.log(response),esArticulo&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),esArticulo?$("[data-ce-article="+articleId+'] [data-ce-video="'+subjectId+'"]').attr("src",src):$("[data-ce-video="+subjectId+"]").attr("src",src),$(document).one("VIDEO_UPLOAD_CHANGE_REQUEST",videoUploadChangeRequest)},function(error){console.log(error),clicEdita.notify(error,"failure"),$(document).one("VIDEO_UPLOAD_CHANGE_REQUEST",videoUploadChangeRequest)})},function(error){console.log(error),clicEdita.notify(error,"error"),$(document).one("VIDEO_UPLOAD_CHANGE_REQUEST",videoUploadChangeRequest)})}),$(document).one("VIDEO_POSTER_CHANGE_REQUEST",function videoPosterChangeRequest(event,subject,contentType){console.log("seleccionado video exitosamente");var subdir=$(subject).attr("data-ce-selected-subdir");(new LocalStorageComponent).requestImageAggregation(subject,subdir).then(function(response){console.log(response.msg);var subjectId=$(subject).attr("data-ce-selected-video"),pageId=$("html").attr("data-ce-page"),poster=response.path,videoComponent=new VideoComponent(subjectId,pageId,poster);videoComponent.set("type","poster");var elemValues=videoComponent.getValues(),senderComponent=new SenderComponent("aggregation","video",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),esArticulo=!1,articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category");void 0!==articleId&&!1!==articleId&&(articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category"),senderComponent.set("category",categoryId),senderComponent.set("article",articleId),esArticulo=!0);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){clicEdita.notify(response,"success"),console.log(response),esArticulo&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),esArticulo?$("[data-ce-article="+articleId+'] [data-ce-video="'+subjectId+'"]').attr("poster",poster):$("[data-ce-video="+subjectId+"]").attr("poster",poster),$(document).one("VIDEO_POSTER_CHANGE_REQUEST",videoPosterChangeRequest)},function(error){console.log(error),clicEdita.notify(error,"failure"),$(document).one("VIDEO_POSTER_CHANGE_REQUEST",videoPosterChangeRequest)})},function(error){console.log(error),clicEdita.notify(error,"error"),$(document).one("VIDEO_POSTER_CHANGE_REQUEST",videoPosterChangeRequest)})}),$(document).one("IMAGE_CHANGE_REQUEST",function imageChangeRequest(event,subject,contentType){console.log("seleccionada imagen exitosamente");var subdir=$(subject).attr("data-ce-selected-subdir");(new LocalStorageComponent).requestImageAggregation(subject,subdir).then(function(response){console.log(response.msg);var subjectId=$(subject).attr("data-ce-selected-image"),pageId=$("html").attr("data-ce-page"),src=response.path,elemValues=new ImageComponent(subjectId,pageId,src).getValues(),senderComponent=new SenderComponent("aggregation","image",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),esArticulo=!1,articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category");void 0!==articleId&&!1!==articleId&&(articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category"),senderComponent.set("category",categoryId),senderComponent.set("article",articleId),esArticulo=!0);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){clicEdita.notify(response,"success"),console.log(response),esArticulo&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove(),esArticulo?$("[data-ce-category="+categoryId+"] [data-ce-article="+articleId+'] img[data-ce-image="'+subjectId+'"]').attr("src",src):$("img[data-ce-image="+subjectId+"]").attr("src",src),$(document).one("IMAGE_CHANGE_REQUEST",imageChangeRequest)},function(error){console.log(error),clicEdita.notify(error,"failure"),$(document).one("IMAGE_CHANGE_REQUEST",imageChangeRequest)})},function(error){console.log(error),clicEdita.notify(error,"error"),$(document).one("IMAGE_CHANGE_REQUEST",imageChangeRequest)})}),$(document).one("ANCHOR_CHANGE_REQUEST",function anchorChangeRequest(event,subject){var subjectId=$(subject).attr("data-ce-anchor"),pageId=$("html").attr("data-ce-page"),href=$(subject).attr("href"),anchorComponent=new AnchorComponent(subjectId,pageId,href);anchorComponent.getSimpleEditor(subject).then(function(response){$(document).one("ANCHOR_CHANGE_REQUEST",anchorChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=anchorComponent.getValues(),senderComponent=new SenderComponent("aggregation","anchor",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId)}var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success"),$(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove()},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("ANCHOR_CHANGE_REQUEST",anchorChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("EMBED_CHANGE_REQUEST",function embedChangeRequest(event,subject){var subjectId=$(subject).attr("data-ce-embed"),pageId=$("html").attr("data-ce-page"),code=$(subject).html(),embedComponent=new EmbedComponent(subjectId,pageId,code);embedComponent.getSimpleEditor(subject).then(function(response){$(document).one("EMBED_CHANGE_REQUEST",embedChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=embedComponent.getValues(),senderComponent=new SenderComponent("aggregation","embed",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId)}var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success"),$(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove()},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("EMBED_CHANGE_REQUEST",embedChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("IMAGE_ALT_CHANGE_REQUEST",function imageAltChange(event,subject){var subjectId=$(subject).attr("data-ce-image"),pageId=$("html").attr("data-ce-page"),alt=$(subject).attr("alt");null!=alt&&""!=alt||(alt="Sin descripción");var imageComponent=new ImageComponent(subjectId,pageId,alt);imageComponent.set("type","alt"),imageComponent.getSimpleEditor(subject).then(function(response){$(document).one("IMAGE_ALT_CHANGE_REQUEST",imageAltChange),console.log("Elemento editado exitosamente:\n",response);var elemValues=imageComponent.getValues(),senderComponent=new SenderComponent("aggregation","image",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId)}var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success"),$(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").length&&$(subject).parents("[data-ce-article]").prev("span.first-ce-article").remove()},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("IMAGE_ALT_CHANGE_REQUEST",imageAltChange),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("ARTICLE_REMOVAL_REQUEST",function articleRemoval(event,subject){var articleId=$(subject).attr("data-ce-article"),categoryId=$(subject).closest("[data-ce-category]").attr("data-ce-category"),elemValues=new ArticleComponent(articleId,categoryId).getValues(),senderComponent=new SenderComponent("removal","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){clicEdita.notify(response,"success"),console.log(response),$(subject).remove(),$(document).one("ARTICLE_REMOVAL_REQUEST",articleRemoval)},function(error){console.log(error),clicEdita.notify(error,"failure"),$(document).one("ARTICLE_REMOVAL_REQUEST",articleRemoval)})}),$(document).one("ARTICLE_PUBLISH_REQUEST",function articlePublish(event,subject){var articleId=$(subject).attr("data-ce-article"),categoryId=$(subject).closest("[data-ce-category]").attr("data-ce-category"),articleComponent=new ArticleComponent(articleId,categoryId);articleComponent.set("type","publish");var elemValues=articleComponent.getValues(),senderComponent=new SenderComponent("aggregation","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){clicEdita.notify(response,"success"),console.log(response),location.reload(),$(document).one("ARTICLE_PUBLISH_REQUEST",articlePublish)},function(error){console.log(error),clicEdita.notify(error,"failure"),$(document).one("ARTICLE_PUBLISH_REQUEST",articlePublish)})}),$(document).one("ARTICLE_FRIENDLYURL_CHANGE_REQUEST",function friendlyUrlChangeRequest(event,subject){var articleId=$(subject).attr("data-ce-article"),categoryId=$(subject).closest("[data-ce-category]").attr("data-ce-category"),friendlyUrl=$("meta[data-ce-url]").attr("content");null!=friendlyUrl&&""!=friendlyUrl||(friendlyUrl="Escribe la url corta de este artículo");var articleComponent=new ArticleComponent(articleId,categoryId);articleComponent.set("val",friendlyUrl),articleComponent.set("type","friendly_url"),articleComponent.getSimpleEditor(subject).then(function(response){$(document).one("ARTICLE_FRIENDLYURL_CHANGE_REQUEST",friendlyUrlChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=articleComponent.getValues(),senderComponent=new SenderComponent("aggregation","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("ARTICLE_FRIENDLYURL_CHANGE_REQUEST",friendlyUrlChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("ARTICLE_KEYWORD_CHANGE_REQUEST",function keywordChangeRequest(event,subject){var articleId=$(subject).attr("data-ce-article"),categoryId=$(subject).closest("[data-ce-category]").attr("data-ce-category"),keywords=$("meta[name=keywords]").attr("content");null!=keywords&&""!=keywords||(keywords="Escribe las etiquetas que describen a este artículo");var articleComponent=new ArticleComponent(articleId,categoryId);articleComponent.set("val",keywords),articleComponent.getSimpleEditor(subject).then(function(response){$(document).one("ARTICLE_KEYWORD_CHANGE_REQUEST",keywordChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=articleComponent.getValues(),senderComponent=new SenderComponent("aggregation","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("ARTICLE_KEYWORD_CHANGE_REQUEST",keywordChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("PAGE_SHARINGKEYWORD_CHANGE_REQUEST",function sharingPageKeywordChangeRequest(event,subject){var pageId=$("html").attr("data-ce-page"),keyword=$("meta[name=keywords]").attr("content");null!=keyword&&""!=keyword||(keyword="Escribe las palabras clave de esta página");var pageComponent=new PageComponent(pageId,keyword);pageComponent.set("type","sharing_keyword"),pageComponent.getSimpleEditor(subject).then(function(response){$(document).one("PAGE_SHARINGKEYWORD_CHANGE_REQUEST",sharingPageKeywordChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=pageComponent.getValues(),senderComponent=new SenderComponent("aggregation","page",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("PAGE_SHARINGKEYWORD_CHANGE_REQUEST",sharingPageKeywordChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("ARTICLE_SHARINGTITLE_CHANGE_REQUEST",function sharingTitleChangeRequest(event,subject){var articleId=$(subject).attr("data-ce-article"),categoryId=$(subject).closest("[data-ce-category]").attr("data-ce-category"),title=$('meta[property="og:title"]').attr("content");null!=title&&""!=title||(title="Escribe el título de este artículo");var articleComponent=new ArticleComponent(articleId,categoryId);articleComponent.set("val",title),articleComponent.set("type","sharing_title"),articleComponent.getSimpleEditor(subject).then(function(response){$(document).one("ARTICLE_SHARINGTITLE_CHANGE_REQUEST",sharingTitleChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=articleComponent.getValues(),senderComponent=new SenderComponent("aggregation","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("ARTICLE_SHARINGTITLE_CHANGE_REQUEST",sharingTitleChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("PAGE_SHARINGTITLE_CHANGE_REQUEST",function sharingPageTitleChangeRequest(event,subject){var pageId=$("html").attr("data-ce-page"),title=$('meta[property="og:title"]').attr("content");null!=title&&""!=title||(title="Escribe el título de esta página");var pageComponent=new PageComponent(pageId,title);pageComponent.set("type","sharing_title"),pageComponent.getSimpleEditor(subject).then(function(response){$(document).one("PAGE_SHARINGTITLE_CHANGE_REQUEST",sharingPageTitleChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=pageComponent.getValues(),senderComponent=new SenderComponent("aggregation","page",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("PAGE_SHARINGTITLE_CHANGE_REQUEST",sharingPageTitleChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("ARTICLE_SHARINGDESC_CHANGE_REQUEST",function sharingDescriptionChangeRequest(event,subject){var articleId=$(subject).attr("data-ce-article"),categoryId=$(subject).closest("[data-ce-category]").attr("data-ce-category"),description=$('meta[property="og:description"]').attr("content");null!=description&&""!=description||(description="Describe este artículo");var articleComponent=new ArticleComponent(articleId,categoryId);articleComponent.set("val",description),articleComponent.set("type","sharing_description"),articleComponent.getSimpleEditor(subject).then(function(response){$(document).one("ARTICLE_SHARINGDESC_CHANGE_REQUEST",sharingDescriptionChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=articleComponent.getValues(),senderComponent=new SenderComponent("aggregation","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("ARTICLE_SHARINGDESC_CHANGE_REQUEST",sharingDescriptionChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("PAGE_SHARINGDESC_CHANGE_REQUEST",function sharingPageDescriptionChangeRequest(event,subject){var pageId=$("html").attr("data-ce-page"),description=$('meta[property="og:description"]').attr("content");null!=description&&""!=description||(description="Escribe la descripción de esta página");var pageComponent=new PageComponent(pageId,description);pageComponent.set("type","sharing_description"),pageComponent.getSimpleEditor(subject).then(function(response){$(document).one("PAGE_SHARINGDESC_CHANGE_REQUEST",sharingPageDescriptionChangeRequest),console.log("Elemento editado exitosamente:\n",response);var elemValues=pageComponent.getValues(),senderComponent=new SenderComponent("aggregation","page",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){$(document).one("PAGE_SHARINGDESC_CHANGE_REQUEST",sharingPageDescriptionChangeRequest),console.log("Failure",error),clicEdita.notify(error,"error")})}),$(document).one("ARTICLE_SHARINGIMAGE_CHANGE_REQUEST",function sharingImageChangeRequest(event,subject){var subdir=$(subject).attr("data-ce-selected-subdir");(new LocalStorageComponent).requestImageAggregation(subject,subdir).then(function(response){$(document).one("ARTICLE_SHARINGIMAGE_CHANGE_REQUEST",sharingImageChangeRequest),console.log(response.msg);var articleId=$(subject).attr("data-ce-selected-article"),categoryId=$(subject).attr("data-ce-selected-category"),image_src=response.path,articleComponent=new ArticleComponent(articleId,categoryId);articleComponent.set("val",image_src),articleComponent.set("type","sharing_image");var elemValues=articleComponent.getValues(),senderComponent=new SenderComponent("aggregation","article",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));senderComponent.set("category",categoryId),senderComponent.set("article",articleId);var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){console.log(error),clicEdita.notify(error,"error"),$(document).one("ARTICLE_SHARINGIMAGE_CHANGE_REQUEST",sharingImageChangeRequest)})}),$(document).one("PAGE_SHARINGIMAGE_CHANGE_REQUEST",function sharingPageImageChangeRequest(event,subject){var subdir=$(subject).attr("data-ce-selected-subdir");(new LocalStorageComponent).requestImageAggregation(subject,subdir).then(function(response){$(document).one("PAGE_SHARINGIMAGE_CHANGE_REQUEST",sharingPageImageChangeRequest),console.log(response.msg);var pageId=$(subject).attr("data-ce-selected-page"),image_src=response.path,pageComponent=new PageComponent(pageId,image_src);pageComponent.set("type","sharing_image");var elemValues=pageComponent.getValues(),senderComponent=new SenderComponent("aggregation","page",elemValues,clicEdita.get("API_key"),clicEdita.get("domain")),jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success")},function(error){console.log(error),clicEdita.notify(error,"error")})},function(error){console.log(error),clicEdita.notify(error,"error"),$(document).one("PAGE_SHARINGIMAGE_CHANGE_REQUEST",sharingPageImageChangeRequest)})}),$(document).one("COMPOSED_TYPE_CHANGE_REQUEST",function composedChangeRequest(event,subject,type){var subjectId=$(subject).attr("data-ce-composed"),pageId=$("html").attr("data-ce-page"),elemValues=new ComposedComponent(subjectId,pageId,type).getValues(),senderComponent=new SenderComponent("aggregation","composed",elemValues,clicEdita.get("API_key"),clicEdita.get("domain"));if($(subject).parents("[data-ce-article]").length&&$(subject).parents("[data-ce-category]").length){var articleId=$(subject).parents("[data-ce-article]").attr("data-ce-article"),categoryId=$(subject).parents("[data-ce-category]").attr("data-ce-category");senderComponent.set("category",categoryId),senderComponent.set("article",articleId)}var jsonData=senderComponent.getJSON();senderComponent.requestAggregation(jsonData).then(function(response){console.log(response),clicEdita.notify(response,"success"),location.reload()},function(error){console.log(error),$(document).one("COMPOSED_TYPE_CHANGE_REQUEST",composedChangeRequest),clicEdita.notify(error,"error")})});var PageComponent=function(id,val){var private={id:id,val:val,type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_keywords=private.val;$("body").after('<div class="ce-keywords-editor-container"><div class="ce-keywords-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>'+{sharing_title:"Título de la página",sharing_description:"Descripción de la página",sharing_keyword:"Palabras clave de la página",sharing_image:"Imágen para compartir de la página"}[private.type]+'</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/Pagina.svg"><p data-ce-keywords-editor contenteditable>'+current_keywords+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$("p[data-ce-keywords-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-keywords-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")):(private.val=$("p[data-ce-keywords-editor]").html(),resolve("Tu input fue "+private.val),$("p[data-ce-keywords-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-keywords-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-keywords-editor]").focusout(function(e){private.val=$("p[data-ce-keywords-editor]").html(),resolve("Tu input fue "+private.val),$("p[data-ce-keywords-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-keywords-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},ComposedComponent=function(id,pageId,value){var private={id:id,pageId:pageId,val:value};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},EmbedComponent=function(id,pageId,value){var private={id:id,pageId:pageId,val:value,type:"default"},converter_html=function(html){var map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return html.replace(/[&<>"']/g,function(m){return map[m]})};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_code=converter_html(private.val);$("body").after('<div class="ce-anchor-editor-container"><div class="ce-anchor-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>Código embebido</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/embebido.svg"><p data-ce-anchor-editor contenteditable>'+current_code+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$("p[data-ce-anchor-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-anchor-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"),$(DOM_Element).html(private.val)):(private.val=$("p[data-ce-anchor-editor]").text(),$(DOM_Element).html(private.val),resolve("Tu input fue "+private.val),$("p[data-ce-anchor-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-anchor-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-anchor-editor]").focusout(function(e){private.val=$("p[data-ce-anchor-editor]").text(),$(DOM_Element).html(private.val),resolve("Tu input fue "+private.val),$("p[data-ce-anchor-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-anchor-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private},escapeHtml:function(html){}}},AnchorComponent=function(id,pageId,value){var private={id:id,pageId:pageId,val:value,type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_href=private.val;$("body").after('<div class="ce-anchor-editor-container"><div class="ce-anchor-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>URL del enlace</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/link.svg"><p data-ce-anchor-editor contenteditable>'+current_href+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$("p[data-ce-anchor-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-anchor-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"),$(DOM_Element).attr("href",private.val)):(private.val=$("p[data-ce-anchor-editor]").html(),$(DOM_Element).attr("href",private.val),resolve("Tu input fue "+private.val),$("p[data-ce-anchor-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-anchor-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-anchor-editor]").focusout(function(e){private.val=$("p[data-ce-anchor-editor]").html(),$(DOM_Element).attr("href",private.val),resolve("Tu input fue "+private.val),$("p[data-ce-anchor-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-anchor-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},ArticleComponent=function(id,categoryId){var private={id:id,categoryId:categoryId,val:"default",type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_keywords=private.val;$("body").after('<div class="ce-keywords-editor-container"><div class="ce-keywords-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>'+{sharing_title:"Título del artículo",sharing_description:"Descripción del artículo",default:"Palabras clave del artículo",sharing_image:"Imágen para compartir del artículo",friendly_url:"URL corta del artículo"}[private.type]+'</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/articulo.svg"><p data-ce-keywords-editor contenteditable>'+current_keywords+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$("p[data-ce-keywords-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-keywords-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")):(private.val=$("p[data-ce-keywords-editor]").html(),resolve("Tu input fue "+private.val),$("p[data-ce-keywords-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-keywords-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-keywords-editor]").focusout(function(e){private.val=$("p[data-ce-keywords-editor]").html(),resolve("Tu input fue "+private.val),$("p[data-ce-keywords-editor]").unbind("focusout"),$(document).unbind("keydown"),$("div.ce-keywords-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},AudioComponent=function(audioId,pageId,value){var private={id:audioId,pageId:pageId,val:value,type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_val=private.val;$("body").after('<div class="ce-alt-editor-container"><div class="ce-alt-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>URL del audio</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/audio.svg"><p data-ce-alt-editor contenteditable>'+current_val+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"),$(DOM_Element).find("source").attr("src",private.val)):(private.val=$("p[data-ce-alt-editor]").html(),$(DOM_Element).find("source").attr("src",private.val),resolve("Tu input fue "+private.val),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-alt-editor]").focusout(function(e){private.val=$("p[data-ce-alt-editor]").html(),$(DOM_Element).find("source").attr("src",private.val),resolve("Tu input fue "+private.val),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},ImageComponent=function(imageId,pageId,value){var private={id:imageId,pageId:pageId,val:value,type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_alt=private.val;$("body").after('<div class="ce-alt-editor-container"><div class="ce-alt-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>Descripción de la imagen</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/imagen.svg"><p data-ce-alt-editor contenteditable>'+current_alt+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"),$(DOM_Element).attr("alt",private.val)):(private.val=$("p[data-ce-alt-editor]").html(),$(DOM_Element).attr("alt",private.val),resolve("Tu input fue "+private.val),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-alt-editor]").focusout(function(e){private.val=$("p[data-ce-alt-editor]").html(),$(DOM_Element).attr("alt",private.val),resolve("Tu input fue "+private.val),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},LocalStorageComponent=function(operationType,dataType,data){return{requestImageAggregation:function(data,subdir){return $("body").after('<div class="ce-upload-progress"><progress value="0" max="100"></progress></div>'),new Promise(function(resolve,reject){jQuery.ajax({type:"POST",url:clicEdita.get("LOCAL_MEDIA_HANDLER")+"?image=1&subdir="+subdir,data:new FormData(data),xhr:function(){var myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",upload_progress,!1),myXhr},contentType:!1,processData:!1}).done(function(response){resolve(response),$("div.ce-upload-progress").remove()}).fail(function(response){reject(response.responseJSON.msg),$("div.ce-upload-progress").remove()})})},requestAudioAggregation:function(data,subdir){return $("body").after('<div class="ce-upload-progress"><progress value="0" max="100"></progress></div>'),new Promise(function(resolve,reject){jQuery.ajax({type:"POST",url:clicEdita.get("LOCAL_MEDIA_HANDLER")+"?audio=1&subdir="+subdir,data:new FormData(data),xhr:function(){var myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",upload_progress,!1),myXhr},contentType:!1,processData:!1}).done(function(response){resolve(response),$("div.ce-upload-progress").remove()}).fail(function(response){reject(response.responseJSON.msg),$("div.ce-upload-progress").remove()})})},requestVideoAggregation:function(data,subdir){return $("body").after('<div class="ce-upload-progress"><progress value="0" max="100"></progress></div>'),new Promise(function(resolve,reject){jQuery.ajax({type:"POST",url:clicEdita.get("LOCAL_MEDIA_HANDLER")+"?video=1&subdir="+subdir,data:new FormData(data),xhr:function(){var myXhr=$.ajaxSettings.xhr();return myXhr.upload&&myXhr.upload.addEventListener("progress",upload_progress,!1),myXhr},contentType:!1,processData:!1}).done(function(response){resolve(response),$("div.ce-upload-progress").remove()}).fail(function(response){reject(response.responseJSON.msg),$("div.ce-upload-progress").remove()})})}}};function upload_progress(e){e.lengthComputable&&$("progress").attr({value:e.loaded,max:e.total})}var SenderComponent=function(operationType,dataType,elemValues,API_key,domain){var private={operationType:operationType,dataType:dataType,elemValues:elemValues,category:"none",article:"none",API_key:API_key,domain:domain};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},requestAggregation:function(jsonData){return new Promise(function(resolve,reject){jQuery.ajax({type:"POST",url:"https://yoco.ws/clic-edita/src/server/handler.php",dataType:"json",data:jsonData}).done(function(response){resolve(response.msg)}).fail(function(response){reject(response.responseJSON.msg)})})},requestRemoval:function(jsonData){return new Promise(function(resolve,reject){jQuery.ajax({type:"POST",url:"https://yoco.ws/clic-edita/src/server/handler.php",dataType:"json",data:jsonData}).done(function(response){resolve(response.msg)}).fail(function(response){reject(response.responseJSON.msg)})})},getJSON:function(){return JSON.stringify(private)}}},TextComponent=function(textId,pageId,value){var private={id:textId,pageId:pageId,val:value,type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).focusout(function(e){private.val!==$(DOM_Element).html()?(private.val=$(DOM_Element).html(),resolve("Tu input fue "+private.val)):reject("Sin cambios"),$(DOM_Element).unbind("keydown"),$(DOM_Element).unbind("focusout"),$(DOM_Element).attr("contenteditable",!1),$(DOM_Element).attr("contenteditable",!0)}),$(DOM_Element).keydown(function(e){if(27==e.keyCode&&(reject("Operacion anulada"),$(DOM_Element).unbind("keydown"),$(DOM_Element).unbind("focusout"),$(DOM_Element).html(private.val)),13===e.keyCode)return document.execCommand("insertHTML",!1,"<br><br>"),!1})})},getAdvancedEditor:function(DOM_Element){$(DOM_Element).addClass("medium-editor");var editor=new MediumEditor(".medium-editor",{toolbar:{buttons:["bold","italic","underline",{name:"anchor",aria:"enlace",contentDefault:'<img class="icon-btn-ce-editor" src="http://cliqued.it/ce-resources/img/link.svg">'},{name:"justifyLeft",aria:"justifyLeft",contentDefault:'<img class="icon-btn-ce-editor" src="http://cliqued.it/ce-resources/img/left-alignment.svg">'},{name:"justifyCenter",aria:"justifyCenter",contentDefault:'<img class="icon-btn-ce-editor" src="http://cliqued.it/ce-resources/img/right-alignment.svg">'},{name:"justifyRight",aria:"justifyRight",contentDefault:'<img class="icon-btn-ce-editor" src="http://cliqued.it/ce-resources/img/center-alignment.svg">'},"removeFormat","html"]},paste:{forcePlainText:!0,cleanPastedHTML:!1},extensions:{paste:{}}});return new Promise(function(resolve,reject){$(DOM_Element).focusout(function(e){$(".medium-editor-toolbar:hover").length||$(document).trigger("EXIT_TEXT_EDITOR")}),$(document).on("EXIT_TEXT_EDITOR",function(){if($(DOM_Element).is(":focus"))return alert("something still focused"),!1;private.val!==$(DOM_Element).html()?(private.val=$(DOM_Element).html(),resolve("Tu input fue "+private.val)):reject("Sin cambios"),editor.destroy(),$(DOM_Element).unbind("keydown"),$(DOM_Element).unbind("focusout"),$(document).unbind("EXIT_TEXT_EDITOR"),$(DOM_Element).attr("contenteditable",!1),$(DOM_Element).attr("contenteditable",!0)}),$(DOM_Element).keydown(function(e){if(27==e.keyCode&&(reject("Operacion anulada"),$(DOM_Element).unbind("keydown"),$(DOM_Element).unbind("focusout"),$(DOM_Element).html(private.val)),13===e.keyCode)return document.execCommand("insertHTML",!1,"<br><br>"),!1})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}},VideoComponent=function(videoId,pageId,value){var private={id:videoId,pageId:pageId,val:value,type:"default"};return{get:function(prop){if(private.hasOwnProperty(prop))return private[prop]},set:function(prop,value){private.hasOwnProperty(prop)&&(private[prop]=value)},getSimpleEditor:function(DOM_Element){return new Promise(function(resolve,reject){$(DOM_Element).addClass("ce-blur-content");var current_val=private.val;$("body").after('<div class="ce-alt-editor-container"><div class="ce-alt-editor clic-edita-editor hidden-clic-edita-editor"><div class="header-editor-clic-edita"><p>URL del video</p></div><div class="cuerpo-editor-clic-edita"><img src="http://cliqued.it/ce-resources/img/video.svg"><p data-ce-alt-editor contenteditable>'+current_val+"</p></div></div></div>"),setTimeout(function(){$("div.clic-edita-editor").removeClass("hidden-clic-edita-editor")},1),$(document).keydown(function(e){13!=e.keyCode||e.shiftKey?27==e.keyCode&&(reject("Operacion anulada"),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"),$(DOM_Element).attr("src",private.val)):(private.val=$("p[data-ce-alt-editor]").html(),$(DOM_Element).attr("src",private.val),resolve("Tu input fue "+private.val),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content"))}),$("p[data-ce-alt-editor]").focusout(function(e){private.val=$("p[data-ce-alt-editor]").html(),$(DOM_Element).attr("src",private.val),resolve("Tu input fue "+private.val),$(document).unbind("keydown"),$("p[data-ce-alt-editor]").unbind("focusout"),$("div.ce-alt-editor-container").remove(),$(DOM_Element).removeClass("ce-blur-content")})})},getJSON:function(){return JSON.stringify(private)},getValues:function(){return private}}};